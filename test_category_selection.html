<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Category Selection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-6">O11y Sources Category Selection Test</h1>

        <!-- Mode Selection -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Selection Mode</label>
            <select id="test-mode-select" class="w-full p-2 border border-gray-300 rounded-md">
                <option value="custom">Custom</option>
                <option value="category">Category</option>
            </select>
        </div>

        <!-- Custom Mode -->
        <div id="custom-mode">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Available Sources</label>
                <div class="border border-gray-300 rounded-md p-3 bg-gray-50">
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" value="Apache" class="mr-2"> Apache
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" value="Azure_Firewall" class="mr-2"> Azure Firewall
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" value="LinuxMonitor" class="mr-2"> Linux Monitor
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" value="MongoDB" class="mr-2"> MongoDB
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" value="Mssql" class="mr-2"> MSSQL
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" value="Azure_Redis_Cache" class="mr-2"> Azure Redis Cache
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Mode -->
        <div id="category-mode" class="hidden">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Select Category</label>
                <select id="test-category-select" class="w-full p-2 border border-gray-300 rounded-md">
                    <option value="">Choose a category...</option>
                    <option value="category1">Azure Services (Azure_Firewall, Azure_Redis_Cache)</option>
                    <option value="category2">Web & Database (Apache, MongoDB)</option>
                    <option value="category3">System & Database (LinuxMonitor, Mssql)</option>
                </select>
            </div>

            <!-- Selected Category Info -->
            <div id="selected-category-info" class="mt-4 p-3 rounded-lg bg-blue-50 border border-blue-200 hidden">
                <div class="flex items-center gap-2 text-blue-800">
                    <span class="text-sm font-medium">Selected: <span id="selected-category-name">None</span></span>
                </div>
                <div class="mt-1 text-xs text-blue-600">
                    Sources: <span id="selected-category-sources">None</span>
                </div>
            </div>
        </div>

        <!-- Results -->
        <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-md">
            <h3 class="font-medium mb-2">Current Selection:</h3>
            <div id="selection-results">
                <p class="text-sm text-gray-600">No sources selected</p>
            </div>
        </div>
    </div>

    <script>
        // Simplified test implementation
        class TestO11yManager {
            constructor() {
                this.categories = {
                    category1: {
                        name: 'Category 1 (Azure Services)',
                        sources: ['Azure_Firewall', 'Azure_Redis_Cache'],
                        description: 'Azure Firewall and Azure Redis Cache monitoring'
                    },
                    category2: {
                        name: 'Category 2 (Web & Database)',
                        sources: ['Apache', 'MongoDB'],
                        description: 'Apache web server and MongoDB database monitoring'
                    },
                    category3: {
                        name: 'Category 3 (System & Database)',
                        sources: ['LinuxMonitor', 'Mssql'],
                        description: 'Linux system monitoring and Microsoft SQL Server'
                    }
                };

                this.selectedSources = [];
                this.currentMode = 'custom';
                this.selectedCategory = null;

                this.initialize();
            }

            initialize() {
                // Mode switching
                document.getElementById('test-mode-select').addEventListener('change', (e) => {
                    this.switchMode(e.target.value);
                });

                // Category selection
                document.getElementById('test-category-select').addEventListener('change', (e) => {
                    this.selectCategory(e.target.value);
                });

                // Custom checkboxes
                const checkboxes = document.querySelectorAll('#custom-mode input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        this.toggleSource(e.target.value, e.target.checked);
                    });
                });

                this.updateDisplay();
            }

            switchMode(mode) {
                this.currentMode = mode;
                this.selectedSources = [];

                const customMode = document.getElementById('custom-mode');
                const categoryMode = document.getElementById('category-mode');

                if (mode === 'category') {
                    customMode.classList.add('hidden');
                    categoryMode.classList.remove('hidden');
                    this.deselectCategory();
                } else {
                    customMode.classList.remove('hidden');
                    categoryMode.classList.add('hidden');
                    this.updateCustomCheckboxes();
                }

                this.updateDisplay();
            }

            selectCategory(categoryKey) {
                if (!categoryKey || !this.categories[categoryKey]) {
                    this.deselectCategory();
                    return;
                }

                this.selectedCategory = categoryKey;
                const category = this.categories[categoryKey];

                // Update selected category info display
                this.updateSelectedCategoryInfo(category);

                // Select sources
                this.selectedSources = [...category.sources];
                this.updateDisplay();
            }

            updateSelectedCategoryInfo(category) {
                const infoElement = document.getElementById('selected-category-info');
                const nameElement = document.getElementById('selected-category-name');
                const sourcesElement = document.getElementById('selected-category-sources');

                if (infoElement && nameElement && sourcesElement) {
                    nameElement.textContent = category.name;
                    sourcesElement.textContent = category.sources.join(', ');
                    infoElement.classList.remove('hidden');
                }
            }

            deselectCategory() {
                this.selectedCategory = null;
                this.selectedSources = [];

                // Reset category dropdown
                document.getElementById('test-category-select').value = '';

                // Hide selected category info
                const infoElement = document.getElementById('selected-category-info');
                if (infoElement) {
                    infoElement.classList.add('hidden');
                }
            }

            toggleSource(source, selected) {
                if (selected) {
                    if (!this.selectedSources.includes(source)) {
                        this.selectedSources.push(source);
                    }
                } else {
                    this.selectedSources = this.selectedSources.filter(s => s !== source);
                }
                this.updateDisplay();
            }

            updateCustomCheckboxes() {
                const checkboxes = document.querySelectorAll('#custom-mode input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.selectedSources.includes(checkbox.value);
                });
            }

            updateDisplay() {
                const resultsDiv = document.getElementById('selection-results');
                const selectedSourcesDiv = document.getElementById('selected-sources');

                if (this.selectedSources.length === 0) {
                    resultsDiv.innerHTML = '<p class="text-sm text-gray-600">No sources selected</p>';
                    selectedSourcesDiv.textContent = 'None';
                } else {
                    const sourceList = this.selectedSources.map(source => `<span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-1 mb-1">${source}</span>`).join('');
                    resultsDiv.innerHTML = `<div class="text-sm">${sourceList}</div>`;
                    selectedSourcesDiv.textContent = this.selectedSources.join(', ');
                }
            }
        }

        // Initialize test
        new TestO11yManager();
    </script>
</body>
</html>